<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CBL • Trades Admin</title>
  <style>

    :root{
      --ink:#141414;
      --muted:#4a4a4a;
      --paper:#f7f2e6;
      --paper2:#fbf8f1;
      --rule: rgba(0,0,0,.35);
      --thin: rgba(0,0,0,.18);
      --accent:#7a1f1f;
      --shadow: 0 16px 42px rgba(0,0,0,.18);
      --grid:#d9d9d9;
      --grid2:#9a9a9a;
      --sep:#ececec;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--ink);
      font-family: Georgia, "Times New Roman", Times, serif;
      background:
        radial-gradient(1100px 650px at 20% -10%, rgba(0,0,0,.08), rgba(0,0,0,0) 55%),
        radial-gradient(900px 650px at 90% 0%, rgba(0,0,0,.06), rgba(0,0,0,0) 58%),
        linear-gradient(180deg, #ffffff 0%, #eef1f4 100%);
      padding: 18px 14px 40px;
    }
    a{color:inherit}
    .page{
      max-width: 1180px;
      margin: 0 auto;
      background:
        radial-gradient(circle at 22% 18%, rgba(255,255,255,.75), rgba(255,255,255,0) 52%),
        radial-gradient(circle at 78% 22%, rgba(255,255,255,.70), rgba(255,255,255,0) 55%),
        linear-gradient(180deg, var(--paper2), var(--paper));
      border: 1px solid rgba(0,0,0,.22);
      box-shadow: var(--shadow);
      border-radius: 18px;
      overflow:hidden;
      position:relative;
    }
    .page::before{
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(0deg, rgba(0,0,0,.015) 0px, rgba(0,0,0,.015) 1px, rgba(0,0,0,0) 3px, rgba(0,0,0,0) 6px),
        repeating-linear-gradient(90deg, rgba(0,0,0,.010) 0px, rgba(0,0,0,.010) 1px, rgba(0,0,0,0) 4px, rgba(0,0,0,0) 8px);
      opacity:.55;
      pointer-events:none;
      mix-blend-mode:multiply;
    }
    .wrap{position:relative; z-index:1; padding: 18px 18px 22px;}

    .masthead{
      text-align:center;
      border-bottom: 4px double var(--rule);
      padding-bottom: 12px;
      margin-bottom: 10px;
    }
    .mast-top{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 850;
      color: var(--muted);
      letter-spacing: .02em;
      font-size: 12px;
      flex-wrap:wrap;
    }
    .mast-title{
      margin: 6px 0 6px;
      font-size: 42px;
      line-height: 1;
      letter-spacing: .06em;
      text-transform: uppercase;
      font-weight: 900;
    }
    .mast-sub{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 850;
      letter-spacing:.03em;
      text-transform: uppercase;
    }

    .strap{
      margin-top: 10px;
      padding: 10px 12px;
      border-top: 1px solid var(--thin);
      border-bottom: 1px solid var(--thin);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 900;
      color: var(--ink);
      align-items:center;
    }
    .strap .tag{display:inline-flex; gap:8px; align-items:center; white-space:nowrap}
    .strap a{
      text-decoration:none;
      border-bottom: 2px solid rgba(0,0,0,.25);
      padding-bottom:2px;
    }
    .strap a:hover{border-bottom-color: rgba(122,31,31,.8); color: var(--accent);}
    .strap .right{white-space:nowrap}

    .topTools{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      margin: 14px 0 10px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .searchWrap{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    input[type="search"], select{
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid rgba(0,0,0,.25);
      background: rgba(255,255,255,.75);
      font-weight: 850;
      outline:none;
    }
    input[type="search"]{ width:min(520px, 92vw); }
    select{ cursor:pointer; }

    .btns{display:flex; gap:8px; flex-wrap:wrap}
    button, .fileLabel{
      border: 1px solid rgba(0,0,0,.22);
      background: rgba(255,255,255,.85);
      padding: 9px 12px;
      border-radius: 12px;
      font-weight: 950;
      cursor:pointer;
    }
    button:hover, .fileLabel:hover{border-color: rgba(122,31,31,.55); color: var(--accent);}
    .fileLabel{display:inline-flex; gap:8px; align-items:center}
    input[type="file"]{display:none}

    .sheet{
      width:100%;
      border: 1px solid var(--grid2);
      border-radius: 14px;
      overflow:hidden;
      background: rgba(255,255,255,.55);
    }
    .headRow{
      display:grid;
      grid-template-columns: 160px 1fr 1fr 14px 1fr 1fr 160px;
      border-bottom:1px solid var(--grid2);
      background: rgba(255,255,255,.75);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 950;
      font-size: 13px;
    }
    .headRow > div{
      padding:10px;
      border-right:1px solid var(--grid);
      display:flex; align-items:center; justify-content:center;
    }
    .headRow .sep{background:var(--sep); padding:0}
    .headRow > div:last-child{border-right:0}

    .tradeRow{
      display:grid;
      grid-template-columns: 160px 1fr 1fr 14px 1fr 1fr 160px;
      border-bottom:1px solid var(--grid);
      min-height:86px;
    }
    .tradeRow:last-child{border-bottom:0}
    .cell{
      padding:10px;
      border-right:1px solid var(--grid);
      position:relative;
    }
    .cell:last-child{border-right:0}
    .cell.sep{background:var(--sep); padding:0}
    .dateCell{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 950;
      color: var(--accent);
      letter-spacing:.03em;
      font-size: 13px;
      text-transform: uppercase;
    }
    .phase{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 900;
      font-size: 11px;
      color:#000;
      margin-top:6px;
    }
    .teamBox{
      border-top: 2px solid rgba(0,0,0,.6);
      padding-top:6px;
      min-height:64px;
    }
    .teamName{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 950;
      font-size: 14px;
      margin:0 0 4px;
    }
    ul.items{margin:0; padding-left:18px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; font-weight: 850; font-size: 13px; line-height:1.25}
    ul.items li{margin:2px 0}
    .muted{color:var(--muted); font-weight:850; font-size:11px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin-top:6px}

    .footer{
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(0,0,0,.18);
      text-align:center;
      color: rgba(0,0,0,.55);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 800;
      font-size: 12px;
    }

    .errorBox{
      border: 1px solid rgba(0,0,0,.22);
      border-radius: 14px;
      padding: 12px;
      background: rgba(255,255,255,.7);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 850;
      color: #000;
      margin: 10px 0 0;
    }
    .errorBox b{color: var(--accent)}

    @media (max-width: 980px){
      .headRow, .tradeRow{grid-template-columns: 140px 1fr 1fr 10px 1fr 1fr 140px;}
    }
    @media (max-width: 760px){
      .headRow{display:none}
      .tradeRow{grid-template-columns: 1fr;}
      .cell{border-right:0; border-bottom:1px solid var(--grid)}
      .cell.sep{display:none}
      .cell:last-child{border-bottom:0}
    }

    [contenteditable="true"]{outline:none;border-radius:8px;padding:2px 4px;margin-left:-4px}
    [contenteditable="true"]:hover{background:rgba(0,0,0,.03)}
    [contenteditable="true"]:focus{background:#fff7cc; box-shadow: inset 0 0 0 2px #ffda44}

    .rowActions{
      position:absolute; right:8px; top:8px;
      display:flex; gap:6px;
      opacity:0; transition:.12s ease;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .tradeRow:hover .rowActions{opacity:1}
    .iconBtn{
      border:1px solid rgba(0,0,0,.25);
      background:rgba(255,255,255,.9);
      padding:4px 8px;
      border-radius:10px;
      font-weight:950;
      cursor:pointer;
      font-size:12px;
    }

    dialog{
      width:min(860px, 96vw);
      border:1px solid rgba(0,0,0,.25);
      border-radius: 14px;
      padding: 14px;
      background: rgba(255,255,255,.96);
    }
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .dlgTitle{margin:0 0 10px;font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;font-weight: 950;font-size: 16px;letter-spacing:.02em;}
    .formGrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .formRow{display:flex; flex-direction:column; gap:6px}
    label{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;font-weight: 950;font-size: 12px;letter-spacing:.02em;}
    input, textarea{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;font-weight: 850;font-size: 13px;border:1px solid rgba(0,0,0,.25);border-radius: 12px;padding: 10px 10px;background: rgba(255,255,255,.9);}
    textarea{min-height:90px; resize:vertical}
    .teamsGrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px}
    .dlgActions{display:flex; justify-content:flex-end; gap:8px; margin-top:12px}
    .hint{margin-top:8px;color: var(--muted);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;font-weight: 800;font-size: 12px;line-height:1.35;}
  </style>
</head>
<body>
  <div class="page">
    <div class="wrap">
      <div class="masthead">
        <div class="mast-top">
          <div>TRADES ADMIN</div>
          <div>CBLBASEBALL.NET</div>
          <div>SEASON: <span id="seasonLabel">—</span></div>
        </div>
        <div class="mast-title"><span id="titleSeason">—</span> CBL Trades Admin</div>
        <p class="mast-sub">Edit here, then Export JSON and upload to <b>data/trades-YYYY.json</b></p>
      </div>

      <div class="strap">
        <span class="tag"><b>Quick Links:</b>
          <a href="index.html">Front Page</a> •
          <a href="trades.html?year=2026">Public Trades</a>
        </span>
        <span class="tag right">Powered by FanGraphs</span>
      </div>

      <div class="topTools">
        <div class="searchWrap">
          <select id="yearSelect" title="Select season year"></select>
          <input id="search" type="search" placeholder="Search trades (team, player, pick, date)..." />
        </div>
        <div class="btns">
          <button id="addBtn" type="button">+ Add Trade</button>
          <button id="exportBtn" type="button">Export JSON</button>
          <label class="fileLabel" title="Import a previously exported JSON file">
            Import JSON
            <input id="importFile" type="file" accept="application/json" />
          </label>
          <button id="resetBtn" type="button" title="Reset this year to starter example">Reset This Year</button>
          <button id="printBtn" type="button">Print</button>
        </div>
      </div>

      <div class="sheet" aria-label="Trades sheet">
        <div class="headRow">
          <div>Date</div>
          <div>Team</div>
          <div>Team</div>
          <div class="sep" aria-hidden="true"></div>
          <div>Team</div>
          <div>Team</div>
          <div>Date</div>
        </div>
        <div id="body"></div>
      </div>

      <div class="footer">© Continental Baseball League • Trades Admin (local browser saves)</div>
    </div>
  </div>

  <dialog id="dlg">
    <form method="dialog" id="form">
      <p class="dlgTitle">Add Trade</p>

      <div class="formGrid">
        <div class="formRow">
          <label for="leftDate">Left Date (e.g., 2/4/2026 or June 2025)</label>
          <input id="leftDate" placeholder="2/4/2026" />
        </div>
        <div class="formRow">
          <label for="rightDate">Right Date (optional)</label>
          <input id="rightDate" placeholder="2/6/2026" />
        </div>
        <div class="formRow" style="grid-column:1/-1">
          <label for="phase">Row Label (optional, like “Pre-Cut Down”)</label>
          <input id="phase" placeholder="Pre-Cut Down" />
        </div>
      </div>

      <div class="teamsGrid">
        <div class="formRow">
          <label>Team 1 (name + items, one per line)</label>
          <input id="t1" placeholder="Mets" />
          <textarea id="t1items" placeholder="Corbin Burnes"></textarea>
        </div>
        <div class="formRow">
          <label>Team 2</label>
          <input id="t2" placeholder="Orioles" />
          <textarea id="t2items" placeholder="Trevor Megill&#10;Charlie Morton"></textarea>
        </div>
        <div class="formRow">
          <label>Team 3</label>
          <input id="t3" placeholder="Royals" />
          <textarea id="t3items" placeholder="Seth Lugo"></textarea>
        </div>
        <div class="formRow">
          <label>Team 4</label>
          <input id="t4" placeholder="Yankees" />
          <textarea id="t4items" placeholder="Brayan Bello"></textarea>
        </div>
      </div>

      <div class="hint">
        • Leave a team blank if the trade only has 2–3 teams.<br/>
        • After adding, you can click any team name or line to edit inline. Changes auto-save for that year in your browser.
      </div>

      <div class="dlgActions">
        <button value="cancel">Cancel</button>
        <button id="saveBtn" value="default">Add</button>
      </div>
    </form>
  </dialog>

<script>
(() => {
  const $ = (s) => document.querySelector(s);

  const YEARS = [2026, 2025, 2024, 2023, 2022, 2021, 2020, 2019, 2018, 2017, 2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006, 2005];

  // Starter example (used only when you reset a year)
  const starter = [
  {
    "leftDate": "June 2025",
    "rightDate": "1/30/2026",
    "phase": "Pre-Cut Down",
    "teams": [
      {
        "name": "Mets",
        "items": [
          "Corbin Burnes"
        ]
      },
      {
        "name": "Orioles",
        "items": [
          "Trevor Megill",
          "Charlie Morton"
        ]
      },
      {
        "name": "Mets",
        "items": [
          "Jameson Taillon",
          "KCA DP (6th)"
        ]
      },
      {
        "name": "Royals",
        "items": [
          "Seth Lugo"
        ]
      }
    ]
  },
  {
    "leftDate": "2/1/2026",
    "rightDate": "2/4/2026",
    "phase": "",
    "teams": [
      {
        "name": "Guardians",
        "items": [
          "JT Realmuto"
        ]
      },
      {
        "name": "Braves",
        "items": [
          "CLA DP (1st)"
        ]
      },
      {
        "name": "Mets",
        "items": [
          "Tyrone Taylor"
        ]
      },
      {
        "name": "Braves",
        "items": [
          "NYN DP (6th)"
        ]
      }
    ]
  },
  {
    "leftDate": "2/4/2026",
    "rightDate": "2/6/2026",
    "phase": "",
    "teams": [
      {
        "name": "Orioles",
        "items": [
          "Alec Burleson"
        ]
      },
      {
        "name": "Nationals",
        "items": [
          "Pete Fairbanks"
        ]
      },
      {
        "name": "Twins",
        "items": [
          "Matt Wallner",
          "Randal Grichuk",
          "NYA DP (10th)"
        ]
      },
      {
        "name": "Yankees",
        "items": [
          "Brayan Bello"
        ]
      }
    ]
  },
  {
    "leftDate": "2/6/2026",
    "rightDate": "2/8/2026",
    "phase": "",
    "teams": [
      {
        "name": "Twins",
        "items": [
          "PIN DP (4th)"
        ]
      },
      {
        "name": "Pirates",
        "items": [
          "Chris Paddack"
        ]
      },
      {
        "name": "Cardinals",
        "items": [
          "Willson Contreras"
        ]
      },
      {
        "name": "Cubs",
        "items": [
          "Yainer Diaz"
        ]
      }
    ]
  }
];

  function getYearFromUrl() {
    const u = new URL(window.location.href);
    const y = parseInt(u.searchParams.get("year") || "", 10);
    return Number.isFinite(y) ? y : YEARS[0];
  }

  function setYearInUrl(year) {
    const u = new URL(window.location.href);
    u.searchParams.set("year", year);
    window.location.href = u.toString();
  }

  function esc(s){
    return (s ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  function normalizeTeams(teams){
    const t = (teams || []).filter(x => (x?.name || "").trim().length > 0);
    while (t.length < 4) t.push({name:"", items:[]});
    return t.slice(0,4);
  }

  let year = getYearFromUrl();
  const STORAGE_KEY = `cbl_trades_${year}`;

  // Labels
  $("#seasonLabel").textContent = year;
  $("#titleSeason").textContent = year;

  // Year dropdown
  const sel = $("#yearSelect");
  sel.innerHTML = YEARS.map(y => `<option value="${y}">${y}</option>`).join("");
  sel.value = String(year);
  sel.addEventListener("change", () => setYearInUrl(sel.value));

  function load(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return JSON.parse(JSON.stringify(starter));
      const data = JSON.parse(raw);
      return Array.isArray(data) ? data : JSON.parse(JSON.stringify(starter));
    } catch {
      return JSON.parse(JSON.stringify(starter));
    }
  }

  let trades = load();

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(trades)); }

  function matchesSearch(trade, q){
    if(!q) return true;
    q = q.toLowerCase();
    const parts = [];
    parts.push(trade.leftDate || "", trade.rightDate || "", trade.phase || "");
    (trade.teams || []).forEach(t => {
      parts.push(t.name || "");
      (t.items || []).forEach(i => parts.push(i || ""));
    });
    return parts.join(" ").toLowerCase().includes(q);
  }

  function render(){
    const q = ($("#search").value || "").trim();
    const rows = trades
      .map((tr, idx) => ({tr, idx}))
      .filter(x => matchesSearch(x.tr, q));

    $("#body").innerHTML = rows.map(({tr, idx}) => {
      const teams = normalizeTeams(tr.teams || []);

      const teamCell = (teamIdx) => {
        const tm = teams[teamIdx] || {name:"", items:[]};
        const items = (tm.items || []).length ? tm.items : [""];
        const list = items.map((it, itemIdx) => `<li contenteditable="true" data-idx="${idx}" data-team="${teamIdx}" data-item="${itemIdx}">${esc(it)}</li>`).join("");
        return `
          <div class="cell">
            <div class="teamBox">
              <div class="teamName" contenteditable="true" data-idx="${idx}" data-team="${teamIdx}" data-field="teamName">${esc(tm.name || "Team")}</div>
              <ul class="items">${list}</ul>
              <div class="muted">click to edit</div>
            </div>
          </div>
        `;
      };

      return `
        <div class="tradeRow" data-row="${idx}">
          <div class="cell">
            <div class="rowActions">
              <button class="iconBtn" data-action="dup" data-idx="${idx}" title="Duplicate">⧉</button>
              <button class="iconBtn" data-action="del" data-idx="${idx}" title="Delete">✕</button>
            </div>
            <div class="dateCell" contenteditable="true" data-idx="${idx}" data-field="leftDate">${esc(tr.leftDate || "—")}</div>
            <div class="phase" contenteditable="true" data-idx="${idx}" data-field="phase">${esc(tr.phase || " ")}</div>
          </div>

          ${teamCell(0)}
          ${teamCell(1)}
          <div class="cell sep" aria-hidden="true"></div>
          ${teamCell(2)}
          ${teamCell(3)}

          <div class="cell">
            <div class="dateCell" contenteditable="true" data-idx="${idx}" data-field="rightDate">${esc(tr.rightDate || " ")}</div>
          </div>
        </div>
      `;
    }).join("");
  }

  function ensureItem(idx, teamIdx, itemIdx){
    trades[idx].teams = normalizeTeams(trades[idx].teams || []);
    const tm = trades[idx].teams[teamIdx];
    tm.items = tm.items || [];
    while (tm.items.length <= itemIdx) tm.items.push("");
  }

  // Inline save on blur
  $("#body").addEventListener("blur", (e) => {
    const el = e.target;
    if (!el || !el.hasAttribute("contenteditable")) return;

    const idx = Number(el.dataset.idx);
    if (Number.isNaN(idx) || !trades[idx]) return;

    // trade fields
    if (el.dataset.field && el.dataset.field !== "teamName") {
      trades[idx][el.dataset.field] = (el.textContent || "").trim();
      save(); return;
    }

    // team name
    if (el.dataset.field === "teamName") {
      const teamIdx = Number(el.dataset.team);
      trades[idx].teams = normalizeTeams(trades[idx].teams || []);
      trades[idx].teams[teamIdx].name = (el.textContent || "").trim();
      save(); return;
    }

    // item line
    if (el.tagName === "LI" && el.dataset.team != null) {
      const teamIdx = Number(el.dataset.team);
      const itemIdx = Number(el.dataset.item);
      ensureItem(idx, teamIdx, itemIdx);
      trades[idx].teams[teamIdx].items[itemIdx] = (el.textContent || "").trim();

      // trim trailing blanks
      const items = trades[idx].teams[teamIdx].items || [];
      while(items.length && !items[items.length-1].trim()) items.pop();
      save();
    }
  }, true);

  // row actions
  $("#body").addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-action]");
    if (!btn) return;
    const action = btn.dataset.action;
    const idx = Number(btn.dataset.idx);
    if (!trades[idx]) return;

    if (action === "del") {
      if (!confirm("Delete this trade row?")) return;
      trades.splice(idx, 1);
      save(); render(); return;
    }
    if (action === "dup") {
      trades.splice(idx+1, 0, JSON.parse(JSON.stringify(trades[idx])));
      save(); render(); return;
    }
  });

  // Search / Print
  $("#search").addEventListener("input", render);
  $("#printBtn").addEventListener("click", () => window.print());

  // Dialog add
  const dlg = $("#dlg");
  $("#addBtn").addEventListener("click", () => {
    $("#form").reset?.();
    dlg.showModal();
  });

  $("#saveBtn").addEventListener("click", (e) => {
    e.preventDefault();

    const teamFrom = (nameEl, itemsEl) => {
      const name = (nameEl.value || "").trim();
      const items = (itemsEl.value || "")
        .split("\n")
        .map(s => s.trim())
        .filter(Boolean);
      return name ? { name, items } : null;
    };

    const tr = {
      leftDate: ($("#leftDate").value || "").trim() || "—",
      rightDate: ($("#rightDate").value || "").trim(),
      phase: ($("#phase").value || "").trim(),
      teams: []
    };

    [teamFrom($("#t1"), $("#t1items")),
     teamFrom($("#t2"), $("#t2items")),
     teamFrom($("#t3"), $("#t3items")),
     teamFrom($("#t4"), $("#t4items"))].forEach(t => { if (t) tr.teams.push(t); });

    tr.teams = normalizeTeams(tr.teams);
    trades.unshift(tr);
    save(); render();
    dlg.close();
  });

  // Export JSON (named for year)
  $("#exportBtn").addEventListener("click", async () => {
    const data = JSON.stringify(trades, null, 2);
    try { await navigator.clipboard.writeText(data); } catch {}
    const blob = new Blob([data], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `trades-${year}.json`;
    a.click();
    URL.revokeObjectURL(url);
    alert(`Exported trades-${year}.json (upload to data/trades-${year}.json).`);
  });

  // Import JSON
  $("#importFile").addEventListener("change", async (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    try {
      const text = await file.text();
      const parsed = JSON.parse(text);
      if (!Array.isArray(parsed)) throw new Error("JSON must be an array");
      trades = parsed;
      save(); render();
      alert("Imported successfully (saved for this year in your browser).");
    } catch (err) {
      alert("Import failed: " + (err?.message || err));
    } finally {
      e.target.value = "";
    }
  });

  // Reset this year
  $("#resetBtn").addEventListener("click", () => {
    if(!confirm(`Reset ${year} trades to starter example? This overwrites the saved copy for this year in your browser.`)) return;
    trades = JSON.parse(JSON.stringify(starter));
    save(); render();
  });

  render();
})();
</script>
</body>
</html>
